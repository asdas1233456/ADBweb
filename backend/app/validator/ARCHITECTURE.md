# è„šæœ¬éªŒè¯å™¨ V2.0 - æ¶æ„è®¾è®¡æ–‡æ¡£

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

- **å®‰å…¨æ€§**: æ¼åˆ¤ç‡<5%ã€è¯¯åˆ¤ç‡<3%ï¼ŒæŠ—å¸¸è§æ··æ·†/ç»•è¿‡æ‰‹æ®µ
- **å®ç”¨æ€§**: æ”¯æŒ1000+è„šæœ¬æ‰¹é‡éªŒè¯ï¼Œå•è„šæœ¬éªŒè¯è€—æ—¶<1ç§’
- **å…ˆè¿›æ€§**: ASTè¯­ä¹‰åˆ†æ+è§„åˆ™å¼•æ“ï¼Œæ”¯æŒç°åº¦å‘å¸ƒã€å…¨é“¾è·¯ç›‘æ§

### 1.2 æ ¸å¿ƒèƒ½åŠ›

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è„šæœ¬éªŒè¯å™¨ V2.0                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ASTåˆ†æ   â”‚  â”‚ç¬¦å·æ‰§è¡Œ  â”‚  â”‚æ±¡ç‚¹è¿½è¸ª  â”‚  â”‚æ··æ·†æ£€æµ‹  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚è§„åˆ™å¼•æ“  â”‚  â”‚é£é™©è¯„åˆ†  â”‚  â”‚æ‰¹é‡éªŒè¯  â”‚  â”‚æ€§èƒ½ç›‘æ§  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. æ¶æ„è®¾è®¡

### 2.1 åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ¥å…¥å±‚ (API Layer)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ HTTP API     â”‚  â”‚ Python SDK   â”‚  â”‚ CLI Tool     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      éªŒè¯å±‚ (Validation Layer)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ è¾“å…¥æ ¡éªŒ     â”‚  â”‚ é™æµæ§åˆ¶     â”‚  â”‚ ç¼“å­˜ç®¡ç†     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      åˆ†æå±‚ (Analysis Layer)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ASTè§£æ      â”‚  â”‚ è¯­ä¹‰åˆ†æ     â”‚  â”‚ ç¬¦å·æ‰§è¡Œ     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ æ±¡ç‚¹è¿½è¸ª     â”‚  â”‚ æ··æ·†æ£€æµ‹     â”‚  â”‚ è¡Œä¸ºåˆ†æ     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      è§„åˆ™å±‚ (Rule Layer)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ è§„åˆ™å¼•æ“     â”‚  â”‚ è§„åˆ™åŠ è½½å™¨   â”‚  â”‚ è§„åˆ™ç¼“å­˜     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ å®‰å…¨è§„åˆ™åº“   â”‚  â”‚ è´¨é‡è§„åˆ™åº“   â”‚  â”‚ è‡ªå®šä¹‰è§„åˆ™   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      è¾“å‡ºå±‚ (Output Layer)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ç»“æœç”Ÿæˆ     â”‚  â”‚ æŠ¥å‘Šæ ¼å¼åŒ–   â”‚  â”‚ æ•°æ®è„±æ•     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ æ—¥å¿—å®¡è®¡     â”‚  â”‚ æŒ‡æ ‡ä¸ŠæŠ¥     â”‚  â”‚ å‘Šè­¦é€šçŸ¥     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒæ¨¡å—

#### 2.2.1 éªŒè¯å™¨æ ¸å¿ƒ (validator_v2.py)

```python
ScriptValidatorV2
â”œâ”€â”€ __init__()              # åˆå§‹åŒ–é…ç½®ã€è§„åˆ™å¼•æ“ã€åˆ†æå™¨
â”œâ”€â”€ validate()              # å•è„šæœ¬éªŒè¯
â”œâ”€â”€ validate_batch()        # æ‰¹é‡éªŒè¯ï¼ˆå¹¶å‘ï¼‰
â”œâ”€â”€ validate_async()        # å¼‚æ­¥éªŒè¯
â”œâ”€â”€ get_stats()            # è·å–ç»Ÿè®¡ä¿¡æ¯
â”œâ”€â”€ reload_rules()         # é‡è½½è§„åˆ™
â””â”€â”€ shutdown()             # å…³é—­éªŒè¯å™¨
```

#### 2.2.2 è§„åˆ™å¼•æ“ (rule_engine.py)

```python
RuleEngine
â”œâ”€â”€ __init__()              # åˆå§‹åŒ–è§„åˆ™åŠ è½½å™¨
â”œâ”€â”€ get_rules()            # è·å–è§„åˆ™åˆ—è¡¨
â”œâ”€â”€ execute_rules()        # æ‰§è¡Œè§„åˆ™æ£€æŸ¥
â”œâ”€â”€ add_to_whitelist()     # æ·»åŠ ç™½åå•
â”œâ”€â”€ add_to_blacklist()     # æ·»åŠ é»‘åå•
â”œâ”€â”€ reload_rules()         # é‡è½½è§„åˆ™
â””â”€â”€ get_rule_stats()       # è·å–è§„åˆ™ç»Ÿè®¡

RuleLoader
â”œâ”€â”€ load_rules()           # åŠ è½½æ‰€æœ‰è§„åˆ™
â”œâ”€â”€ check_updates()        # æ£€æŸ¥è§„åˆ™æ›´æ–°
â””â”€â”€ _parse_rules()         # è§£æè§„åˆ™æ•°æ®

Rule
â”œâ”€â”€ matches()              # æ£€æŸ¥è§„åˆ™åŒ¹é…
â””â”€â”€ create_issue()         # åˆ›å»ºéªŒè¯é—®é¢˜
```

#### 2.2.3 Pythonåˆ†æå™¨ (python_analyzer.py)

```python
PythonASTAnalyzer
â”œâ”€â”€ analyze()              # åˆ†æPythonä»£ç 
â”œâ”€â”€ _build_symbol_table()  # æ„å»ºç¬¦å·è¡¨
â”œâ”€â”€ _taint_analysis()      # æ±¡ç‚¹åˆ†æ
â”œâ”€â”€ _propagate_taint()     # æ±¡ç‚¹ä¼ æ’­
â”œâ”€â”€ _detect_dangerous_calls()  # æ£€æµ‹å±é™©å‡½æ•°
â”œâ”€â”€ _detect_obfuscation()  # æ£€æµ‹æ··æ·†
â””â”€â”€ _behavior_analysis()   # è¡Œä¸ºåˆ†æ
```

## 3. æ•°æ®æµç¨‹

### 3.1 å•è„šæœ¬éªŒè¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å…¥ä»£ç   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¾“å…¥éªŒè¯   â”‚  â† å¤§å°ã€è¡Œæ•°ã€æ ¼å¼æ£€æŸ¥
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ASTè§£æ   â”‚  â† è¯­æ³•æ£€æŸ¥ã€æ„å»ºè¯­æ³•æ ‘
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è¯­ä¹‰åˆ†æ   â”‚  â† ç¬¦å·è¡¨ã€æ±¡ç‚¹è¿½è¸ªã€è¡Œä¸ºåˆ†æ
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è§„åˆ™æ£€æŸ¥   â”‚  â† æ‰§è¡Œå®‰å…¨è§„åˆ™ã€è´¨é‡è§„åˆ™
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. é£é™©è¯„åˆ†   â”‚  â† è®¡ç®—é£é™©åˆ†ã€è´¨é‡åˆ†
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ç»“æœç”Ÿæˆ   â”‚  â† æ ¼å¼åŒ–è¾“å‡ºã€è„±æ•å¤„ç†
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éªŒè¯ç»“æœ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ‰¹é‡éªŒè¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è„šæœ¬åˆ—è¡¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»»åŠ¡åˆ†å‘          â”‚  â† ThreadPoolExecutor
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼         â–¼         â–¼         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
   â”‚Workerâ”‚  â”‚Workerâ”‚  â”‚Workerâ”‚  â”‚Workerâ”‚
   â”‚  1   â”‚  â”‚  2   â”‚  â”‚  3   â”‚  â”‚  N   â”‚
   â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜
      â”‚         â”‚         â”‚         â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ ç»“æœèšåˆ      â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ æ‰¹é‡ç»“æœ      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4. æ ¸å¿ƒç®—æ³•

### 4.1 æ±¡ç‚¹åˆ†æç®—æ³•

```python
def taint_analysis(ast_tree):
    """
    æ±¡ç‚¹åˆ†æç®—æ³•
    1. æ ‡è®°æ±¡ç‚¹æºï¼ˆç”¨æˆ·è¾“å…¥ï¼‰
    2. è¿½è¸ªæ±¡ç‚¹ä¼ æ’­ï¼ˆèµ‹å€¼ã€å‡½æ•°è°ƒç”¨ï¼‰
    3. æ£€æµ‹æ±¡ç‚¹æ±‡ï¼ˆå±é™©å‡½æ•°ï¼‰
    """
    tainted_vars = set()
    
    # æ­¥éª¤1: æ ‡è®°æ±¡ç‚¹æº
    for node in ast.walk(ast_tree):
        if is_taint_source(node):
            target_var = get_assignment_target(node)
            tainted_vars.add(target_var)
    
    # æ­¥éª¤2: æ±¡ç‚¹ä¼ æ’­
    changed = True
    while changed:
        changed = False
        for node in ast.walk(ast_tree):
            if is_assignment(node):
                if uses_tainted_var(node.value, tainted_vars):
                    target = get_assignment_target(node)
                    if target not in tainted_vars:
                        tainted_vars.add(target)
                        changed = True
    
    # æ­¥éª¤3: æ£€æµ‹æ±¡ç‚¹æ±‡
    issues = []
    for node in ast.walk(ast_tree):
        if is_taint_sink(node):
            if uses_tainted_var(node, tainted_vars):
                issues.append(create_taint_issue(node))
    
    return issues
```

### 4.2 æ··æ·†æ£€æµ‹ç®—æ³•

```python
def detect_obfuscation(code):
    """
    æ··æ·†æ£€æµ‹ç®—æ³•
    1. Base64æ£€æµ‹ - æ­£åˆ™åŒ¹é…+è§£ç éªŒè¯
    2. åå…­è¿›åˆ¶æ£€æµ‹ - ç»Ÿè®¡\xæ¨¡å¼
    3. å­—ç¬¦ä¸²æ‹¼æ¥æ£€æµ‹ - æ£€æµ‹å¤æ‚æ‹¼æ¥
    4. Unicodeè½¬ä¹‰æ£€æµ‹ - æ£€æµ‹\uæ¨¡å¼
    """
    issues = []
    
    # Base64æ£€æµ‹
    base64_pattern = r'base64\.b64decode\([\'"]([A-Za-z0-9+/=]+)[\'"]\)'
    for match in re.finditer(base64_pattern, code):
        try:
            decoded = base64.b64decode(match.group(1))
            issues.append(create_base64_issue(decoded))
        except:
            pass
    
    # åå…­è¿›åˆ¶æ£€æµ‹
    hex_count = len(re.findall(r'\\x[0-9a-fA-F]{2}', code))
    if hex_count > THRESHOLD:
        issues.append(create_hex_issue(hex_count))
    
    # å­—ç¬¦ä¸²æ‹¼æ¥æ£€æµ‹
    concat_pattern = r'[\'"][^\'"]+[\'"](\s*\+\s*[\'"][^\'"]+[\'"]){3,}'
    if re.search(concat_pattern, code):
        issues.append(create_concat_issue())
    
    return issues
```

### 4.3 é£é™©è¯„åˆ†ç®—æ³•

```python
def calculate_risk_score(issues):
    """
    é£é™©è¯„åˆ†ç®—æ³•
    æ€»åˆ† = Î£(é—®é¢˜é£é™©åˆ† Ã— æƒé‡)
    
    æƒé‡å› ç´ :
    - é—®é¢˜ä¸¥é‡ç¨‹åº¦
    - é—®é¢˜æ•°é‡
    - ä¸Šä¸‹æ–‡ç¯å¢ƒ
    - ä¸šåŠ¡åœºæ™¯
    """
    total_score = 0
    
    for issue in issues:
        base_score = issue.risk_score
        
        # ä¸¥é‡ç¨‹åº¦æƒé‡
        severity_weight = {
            'critical': 1.5,
            'error': 1.2,
            'warning': 1.0,
            'info': 0.5
        }[issue.level]
        
        # ä¸Šä¸‹æ–‡æƒé‡ï¼ˆå¦‚æœåœ¨å¾ªç¯ä¸­ï¼Œé£é™©æ›´é«˜ï¼‰
        context_weight = 1.2 if issue.in_loop else 1.0
        
        # è®¡ç®—åŠ æƒåˆ†æ•°
        weighted_score = base_score * severity_weight * context_weight
        total_score += weighted_score
    
    # å½’ä¸€åŒ–åˆ°0-1000
    return min(1000, int(total_score))
```

## 5. æ€§èƒ½ä¼˜åŒ–

### 5.1 ç¼“å­˜ç­–ç•¥

```python
# ASTè§£æç¼“å­˜
ast_cache = LRUCache(maxsize=1000)

def parse_with_cache(code):
    code_hash = hashlib.md5(code.encode()).hexdigest()
    if code_hash in ast_cache:
        return ast_cache[code_hash]
    
    ast_tree = ast.parse(code)
    ast_cache[code_hash] = ast_tree
    return ast_tree
```

### 5.2 å¹¶å‘å¤„ç†

```python
# æ‰¹é‡éªŒè¯å¹¶å‘
with ThreadPoolExecutor(max_workers=10) as executor:
    futures = [
        executor.submit(validate, script)
        for script in scripts
    ]
    
    results = [
        future.result(timeout=1.0)
        for future in as_completed(futures)
    ]
```

### 5.3 è§„åˆ™ä¼˜åŒ–

```python
# è§„åˆ™æŒ‰ä¼˜å…ˆçº§æ’åºï¼Œé«˜ä¼˜å…ˆçº§å…ˆæ‰§è¡Œ
rules.sort(key=lambda r: r.priority, reverse=True)

# è§„åˆ™çŸ­è·¯ï¼šå‘ç°ä¸¥é‡é—®é¢˜ç«‹å³è¿”å›
for rule in rules:
    if rule.severity == 'critical':
        issues = rule.check(code)
        if issues:
            return issues  # çŸ­è·¯è¿”å›
```

## 6. ç›‘æ§æŒ‡æ ‡

### 6.1 æ€§èƒ½æŒ‡æ ‡

- **QPS**: æ¯ç§’éªŒè¯è¯·æ±‚æ•°
- **å¹³å‡è€—æ—¶**: å•æ¬¡éªŒè¯å¹³å‡æ—¶é—´
- **P50/P95/P99**: è€—æ—¶åˆ†ä½æ•°
- **ååé‡**: æ‰¹é‡éªŒè¯ååé‡

### 6.2 è´¨é‡æŒ‡æ ‡

- **é€šè¿‡ç‡**: éªŒè¯é€šè¿‡çš„è„šæœ¬æ¯”ä¾‹
- **æ¼åˆ¤ç‡**: æœªæ£€æµ‹å‡ºçš„å±é™©è„šæœ¬æ¯”ä¾‹
- **è¯¯åˆ¤ç‡**: è¯¯æŠ¥çš„å®‰å…¨è„šæœ¬æ¯”ä¾‹
- **é£é™©åˆ†å¸ƒ**: å„é£é™©ç­‰çº§çš„åˆ†å¸ƒ

### 6.3 è§„åˆ™æŒ‡æ ‡

- **è§„åˆ™è¦†ç›–ç‡**: æ‰§è¡Œçš„è§„åˆ™æ¯”ä¾‹
- **è§„åˆ™å‘½ä¸­ç‡**: è§¦å‘çš„è§„åˆ™æ¯”ä¾‹
- **è§„åˆ™è€—æ—¶**: å„è§„åˆ™çš„æ‰§è¡Œæ—¶é—´

## 7. å®‰å…¨ä¿éšœ

### 7.1 è¾“å…¥å®‰å…¨

- å¤§å°é™åˆ¶ï¼ˆé»˜è®¤1MBï¼‰
- è¡Œæ•°é™åˆ¶ï¼ˆé»˜è®¤10000è¡Œï¼‰
- æ ¼å¼éªŒè¯
- é˜²æ³¨å…¥æ£€æŸ¥

### 7.2 æ‰§è¡Œå®‰å…¨

- è¶…æ—¶æ§åˆ¶ï¼ˆé»˜è®¤1ç§’ï¼‰
- æ²™ç®±éš”ç¦»
- èµ„æºé™åˆ¶
- å¼‚å¸¸æ•è·

### 7.3 è¾“å‡ºå®‰å…¨

- æ•°æ®è„±æ•
- å®¡è®¡æ—¥å¿—
- è®¿é—®æ§åˆ¶
- åŠ å¯†ä¼ è¾“

## 8. æ‰©å±•æ€§è®¾è®¡

### 8.1 æ’ä»¶åŒ–è§„åˆ™

```python
# è‡ªå®šä¹‰è§„åˆ™æ’ä»¶
class CustomRule(Rule):
    def matches(self, code, language, ast_tree):
        # è‡ªå®šä¹‰æ£€æµ‹é€»è¾‘
        return custom_check(code)

# æ³¨å†Œè§„åˆ™
rule_engine.register_rule(CustomRule())
```

### 8.2 è‡ªå®šä¹‰åˆ†æå™¨

```python
# è‡ªå®šä¹‰åˆ†æå™¨
class CustomAnalyzer:
    def analyze(self, code):
        # è‡ªå®šä¹‰åˆ†æé€»è¾‘
        return issues

# æ³¨å†Œåˆ†æå™¨
validator.register_analyzer('custom', CustomAnalyzer())
```

### 8.3 å¤šè¯­è¨€æ”¯æŒ

```python
# æ·»åŠ æ–°è¯­è¨€æ”¯æŒ
class GoScriptAnalyzer:
    def analyze(self, code):
        # Goè¯­è¨€åˆ†æé€»è¾‘
        pass

validator.register_language(
    ScriptLanguage.GO,
    GoScriptAnalyzer()
)
```

## 9. éƒ¨ç½²æ¶æ„

### 9.1 å•æœºéƒ¨ç½²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åº”ç”¨æœåŠ¡å™¨               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ScriptValidatorV2       â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ RuleEngine          â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ PythonAnalyzer      â”‚  â”‚
â”‚  â”‚  â””â”€â”€ Cache (Memory)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 åˆ†å¸ƒå¼éƒ¨ç½²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éªŒè¯å™¨1   â”‚     â”‚ éªŒè¯å™¨2   â”‚     â”‚ éªŒè¯å™¨N   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Redis Cache   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 10. æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Python 3.7+
- **ASTè§£æ**: ast (æ ‡å‡†åº“)
- **å¹¶å‘**: ThreadPoolExecutor, asyncio
- **é…ç½®**: YAML
- **ç¼“å­˜**: LRU Cache / Redis
- **æµ‹è¯•**: pytest
- **æ–‡æ¡£**: Markdown

## 11. ç‰ˆæœ¬è§„åˆ’

### V2.0.0 (å½“å‰ç‰ˆæœ¬)
- âœ… æ ¸å¿ƒæ¶æ„
- âœ… ASTåˆ†æ
- âœ… è§„åˆ™å¼•æ“
- âœ… æ‰¹é‡éªŒè¯

### V2.1.0 (è®¡åˆ’ä¸­)
- ğŸ”„ æœºå™¨å­¦ä¹ æ¨¡å‹
- ğŸ”„ æ›´å¤šè¯­è¨€æ”¯æŒ
- ğŸ”„ å¯è§†åŒ–æŠ¥å‘Š
- ğŸ”„ å®æ—¶ç›‘æ§é¢æ¿

### V2.2.0 (æœªæ¥)
- ğŸ“‹ åˆ†å¸ƒå¼ç¼“å­˜
- ğŸ“‹ è§„åˆ™å¸‚åœº
- ğŸ“‹ è‡ªåŠ¨ä¿®å¤å»ºè®®
- ğŸ“‹ CI/CDé›†æˆ
