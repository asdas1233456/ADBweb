# è„šæœ¬æ‰§è¡Œå¤±è´¥è‡ªåŠ¨åˆ†æåŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“– åŠŸèƒ½ç®€ä»‹

è„šæœ¬æ‰§è¡Œå¤±è´¥è‡ªåŠ¨åˆ†æåŠŸèƒ½å¯ä»¥åœ¨ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ—¶ï¼Œè‡ªåŠ¨è¯†åˆ«å¤±è´¥åŸå› ã€å®šä½å¤±è´¥æ­¥éª¤ã€æä¾›è§£å†³å»ºè®®ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è‡ªåŠ¨åˆ†æ

å½“ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§¦å‘å¤±è´¥åˆ†æï¼Œæ— éœ€ä»»ä½•æ‰‹åŠ¨æ“ä½œã€‚

```bash
# æ‰§è¡Œä»»åŠ¡
POST /api/v1/tasks/execute
{
  "task_name": "æµ‹è¯•ä»»åŠ¡",
  "script_id": 1,
  "device_id": 1
}

# ä»»åŠ¡å¤±è´¥åï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ†æ
# åˆ†æç»“æœä¼šè‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“
```

### 2. æŸ¥çœ‹åˆ†æç»“æœ

```bash
# è·å–ä»»åŠ¡çš„å¤±è´¥åˆ†æ
GET /api/v1/failure-analysis/tasks/{task_log_id}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "task_log_id": 15,
    "failure_type": "element_not_found",
    "failure_icon": "ğŸ”",
    "severity": "medium",
    "failed_step_index": 2,
    "failed_step_name": "ç‚¹å‡»ç™»å½•æŒ‰é’®",
    "error_message": "Element not found: ä¸å­˜åœ¨çš„å…ƒç´ ",
    "suggestions": [
      "æ£€æŸ¥å…ƒç´ é€‰æ‹©å™¨æ˜¯å¦æ­£ç¡®",
      "ç¡®è®¤åº”ç”¨ç•Œé¢æ˜¯å¦å·²åŠ è½½å®Œæˆ",
      "å¢åŠ ç­‰å¾…æ—¶é—´è®©ç•Œé¢å®Œå…¨åŠ è½½",
      "ä½¿ç”¨æˆªå›¾ç¡®è®¤å…ƒç´ æ˜¯å¦å­˜åœ¨",
      "æ£€æŸ¥åº”ç”¨ç‰ˆæœ¬æ˜¯å¦å‘ç”Ÿå˜åŒ–"
    ],
    "confidence": 0.9,
    "screenshot_path": "uploads/screenshots/failures/failure_15_20260222_225833.png",
    "created_at": "2026-02-22T22:58:33.584390"
  }
}
```

---

## ğŸ“Š æ”¯æŒçš„é”™è¯¯ç±»å‹

### 1. device_disconnected (è®¾å¤‡æ–­å¼€) ğŸ”Œ

**è¯†åˆ«å…³é”®è¯**: device disconnect, device offline, device not found

**ä¸¥é‡ç¨‹åº¦**: critical (ä¸¥é‡)

**å¸¸è§åŸå› **:
- USBè¿æ¥æ¾åŠ¨
- ADBæœåŠ¡å¼‚å¸¸
- è®¾å¤‡ç”µé‡è€—å°½
- é©±åŠ¨ç¨‹åºé—®é¢˜

**è§£å†³å»ºè®®**:
1. æ£€æŸ¥USBè¿æ¥æ˜¯å¦ç‰¢å›º
2. é‡å¯ADBæœåŠ¡ (`adb kill-server && adb start-server`)
3. æ£€æŸ¥è®¾å¤‡ç”µé‡æ˜¯å¦å……è¶³
4. é‡æ–°å®‰è£…è®¾å¤‡é©±åŠ¨ç¨‹åº
5. å°è¯•æ›´æ¢USBçº¿æˆ–USBå£

---

### 2. element_not_found (å…ƒç´ æœªæ‰¾åˆ°) ğŸ”

**è¯†åˆ«å…³é”®è¯**: element not found, selector not found, no such element

**ä¸¥é‡ç¨‹åº¦**: medium (ä¸­ç­‰)

**å¸¸è§åŸå› **:
- å…ƒç´ é€‰æ‹©å™¨é”™è¯¯
- ç•Œé¢æœªåŠ è½½å®Œæˆ
- åº”ç”¨ç‰ˆæœ¬æ›´æ–°
- å…ƒç´ åŠ¨æ€ç”Ÿæˆ

**è§£å†³å»ºè®®**:
1. æ£€æŸ¥å…ƒç´ é€‰æ‹©å™¨æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤åº”ç”¨ç•Œé¢æ˜¯å¦å·²åŠ è½½å®Œæˆ
3. å¢åŠ ç­‰å¾…æ—¶é—´è®©ç•Œé¢å®Œå…¨åŠ è½½
4. ä½¿ç”¨æˆªå›¾ç¡®è®¤å…ƒç´ æ˜¯å¦å­˜åœ¨
5. æ£€æŸ¥åº”ç”¨ç‰ˆæœ¬æ˜¯å¦å‘ç”Ÿå˜åŒ–

---

### 3. timeout (è¶…æ—¶) â±ï¸

**è¯†åˆ«å…³é”®è¯**: timeout, timed out, time exceeded

**ä¸¥é‡ç¨‹åº¦**: medium (ä¸­ç­‰)

**å¸¸è§åŸå› **:
- æ“ä½œæ‰§è¡Œæ—¶é—´è¿‡é•¿
- ç½‘ç»œå»¶è¿Ÿ
- è®¾å¤‡æ€§èƒ½ä¸è¶³
- åº”ç”¨å“åº”æ…¢

**è§£å†³å»ºè®®**:
1. å¢åŠ è¶…æ—¶æ—¶é—´è®¾ç½®
2. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦ç¨³å®š
3. ä¼˜åŒ–è„šæœ¬æ‰§è¡Œé€»è¾‘
4. æ£€æŸ¥è®¾å¤‡æ€§èƒ½æ˜¯å¦æ­£å¸¸
5. åˆ†è§£å¤æ‚æ“ä½œä¸ºå¤šä¸ªæ­¥éª¤

---

### 4. permission_denied (æƒé™æ‹’ç») ğŸš«

**è¯†åˆ«å…³é”®è¯**: permission denied, access denied, unauthorized

**ä¸¥é‡ç¨‹åº¦**: high (é«˜)

**å¸¸è§åŸå› **:
- åº”ç”¨æƒé™æœªæˆäºˆ
- ç³»ç»Ÿæƒé™é™åˆ¶
- ADBæƒé™ä¸è¶³
- æ–‡ä»¶è®¿é—®å—é™

**è§£å†³å»ºè®®**:
1. æ£€æŸ¥åº”ç”¨æ˜¯å¦å·²æˆäºˆå¿…è¦æƒé™
2. åœ¨è®¾å¤‡è®¾ç½®ä¸­æ‰‹åŠ¨æˆäºˆæƒé™
3. æ£€æŸ¥ADBæ˜¯å¦æœ‰rootæƒé™
4. æ£€æŸ¥ç³»ç»Ÿå®‰å…¨è®¾ç½®
5. å°è¯•ä½¿ç”¨rootæƒé™æ‰§è¡Œ

---

### 5. app_crash (åº”ç”¨å´©æºƒ) ğŸ’¥

**è¯†åˆ«å…³é”®è¯**: crash, force close, app stopped

**ä¸¥é‡ç¨‹åº¦**: high (é«˜)

**å¸¸è§åŸå› **:
- åº”ç”¨bug
- å†…å­˜ä¸è¶³
- å…¼å®¹æ€§é—®é¢˜
- æ•°æ®å¼‚å¸¸

**è§£å†³å»ºè®®**:
1. æŸ¥çœ‹åº”ç”¨å´©æºƒæ—¥å¿—
2. æ›´æ–°åº”ç”¨åˆ°æœ€æ–°ç‰ˆæœ¬
3. æ¸…é™¤åº”ç”¨æ•°æ®å’Œç¼“å­˜
4. æ£€æŸ¥è®¾å¤‡å†…å­˜æ˜¯å¦å……è¶³
5. æ£€æŸ¥åº”ç”¨ä¸ç³»ç»Ÿç‰ˆæœ¬å…¼å®¹æ€§

---

### 6. network_error (ç½‘ç»œé”™è¯¯) ğŸŒ

**è¯†åˆ«å…³é”®è¯**: network error, connection failed, no internet

**ä¸¥é‡ç¨‹åº¦**: medium (ä¸­ç­‰)

**å¸¸è§åŸå› **:
- ç½‘ç»œè¿æ¥æ–­å¼€
- ä»£ç†è®¾ç½®é”™è¯¯
- é˜²ç«å¢™é˜»æ­¢
- DNSè§£æå¤±è´¥

**è§£å†³å»ºè®®**:
1. æ£€æŸ¥è®¾å¤‡ç½‘ç»œè¿æ¥çŠ¶æ€
2. æ£€æŸ¥ä»£ç†è®¾ç½®æ˜¯å¦æ­£ç¡®
3. å…³é—­é˜²ç«å¢™æˆ–æ·»åŠ ä¾‹å¤–
4. å°è¯•åˆ‡æ¢ç½‘ç»œè¿æ¥
5. æ£€æŸ¥DNSè®¾ç½®

---

### 7. script_error (è„šæœ¬é”™è¯¯) ğŸ“

**è¯†åˆ«å…³é”®è¯**: syntax error, undefined, invalid

**ä¸¥é‡ç¨‹åº¦**: high (é«˜)

**å¸¸è§åŸå› **:
- è„šæœ¬è¯­æ³•é”™è¯¯
- å˜é‡æœªå®šä¹‰
- é€»è¾‘é”™è¯¯
- é…ç½®é”™è¯¯

**è§£å†³å»ºè®®**:
1. æ£€æŸ¥è„šæœ¬è¯­æ³•æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æ‰€æœ‰å˜é‡å·²æ­£ç¡®å®šä¹‰
3. ä½¿ç”¨è°ƒè¯•æ¨¡å¼é€æ­¥æ‰§è¡Œ
4. æ£€æŸ¥è„šæœ¬é…ç½®å‚æ•°
5. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

---

## ğŸ“ˆ ç»Ÿè®¡åˆ†æ

### 1. è„šæœ¬å¤±è´¥ç»Ÿè®¡

æŸ¥çœ‹ç‰¹å®šè„šæœ¬çš„å¤±è´¥ç»Ÿè®¡ä¿¡æ¯ï¼š

```bash
GET /api/v1/failure-analysis/scripts/{script_id}/stats
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "script_id": 1,
    "total_failures": 10,
    "failure_by_type": {
      "element_not_found": 5,
      "timeout": 3,
      "device_disconnected": 2
    },
    "most_common_failure": "element_not_found",
    "failure_rate": 15.5,
    "last_failure_time": "2026-02-22T22:58:33.584390"
  }
}
```

### 2. å¤±è´¥è¶‹åŠ¿åˆ†æ

æŸ¥çœ‹ä¸€æ®µæ—¶é—´å†…çš„å¤±è´¥è¶‹åŠ¿ï¼š

```bash
GET /api/v1/failure-analysis/trend?range=week
```

**å‚æ•°**:
- `range`: æ—¶é—´èŒƒå›´
  - `week`: æœ€è¿‘7å¤©
  - `month`: æœ€è¿‘30å¤©
  - `year`: æœ€è¿‘365å¤©
- `script_id`: (å¯é€‰) æŒ‡å®šè„šæœ¬ID

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "range": "week",
    "total_failures": 25,
    "failure_by_type": {
      "element_not_found": 10,
      "timeout": 8,
      "device_disconnected": 5,
      "app_crash": 2
    },
    "start_date": "2026-02-15T22:56:11.087619",
    "end_date": "2026-02-22T22:56:11.088626"
  }
}
```

### 3. å¤±è´¥åˆ†ææ€»è§ˆ

æŸ¥çœ‹å¤±è´¥åˆ†æçš„æ•´ä½“æƒ…å†µï¼š

```bash
GET /api/v1/failure-analysis/overview?days=7
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total_failures": 25,
    "failure_by_type": {
      "element_not_found": 10,
      "timeout": 8,
      "device_disconnected": 5,
      "app_crash": 2
    },
    "most_common_failure": "element_not_found",
    "recent_failures": [
      {
        "id": 1,
        "task_log_id": 15,
        "failure_type": "element_not_found",
        "failure_icon": "ğŸ”",
        "error_message": "Element not found: ä¸å­˜åœ¨çš„å…ƒç´ ",
        "created_at": "2026-02-22T22:58:33.584390"
      }
    ]
  }
}
```

---

## ğŸ” æ­¥éª¤æ‰§è¡Œæ—¥å¿—

æŸ¥çœ‹ä»»åŠ¡çš„è¯¦ç»†æ­¥éª¤æ‰§è¡Œæ—¥å¿—ï¼š

```bash
GET /api/v1/failure-analysis/tasks/{task_log_id}/steps
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "step_index": 1,
      "step_name": "å¯åŠ¨åº”ç”¨",
      "step_type": "launch_app",
      "status": "success",
      "duration": 1500,
      "error_message": null,
      "start_time": "2026-02-22T22:58:30.000000",
      "end_time": "2026-02-22T22:58:31.500000"
    },
    {
      "step_index": 2,
      "step_name": "ç‚¹å‡»ç™»å½•æŒ‰é’®",
      "step_type": "click",
      "status": "failed",
      "duration": 500,
      "error_message": "Element not found: ä¸å­˜åœ¨çš„å…ƒç´ ",
      "start_time": "2026-02-22T22:58:31.500000",
      "end_time": "2026-02-22T22:58:32.000000"
    }
  ]
}
```

---

## ğŸ› ï¸ æ‰‹åŠ¨è§¦å‘åˆ†æ

å¦‚æœéœ€è¦é‡æ–°åˆ†ææŸä¸ªå¤±è´¥çš„ä»»åŠ¡ï¼š

```bash
POST /api/v1/failure-analysis/tasks/{task_log_id}/analyze
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "åˆ†æå®Œæˆ",
  "data": {
    "id": 1,
    "task_log_id": 15,
    "failure_type": "element_not_found",
    "failure_icon": "ğŸ”",
    "severity": "medium",
    "failed_step_index": 2,
    "failed_step_name": "ç‚¹å‡»ç™»å½•æŒ‰é’®",
    "error_message": "Element not found: ä¸å­˜åœ¨çš„å…ƒç´ ",
    "suggestions": [...],
    "confidence": 0.9,
    "screenshot_path": "uploads/screenshots/failures/failure_15_20260222_225833.png",
    "created_at": "2026-02-22T22:58:33.584390"
  }
}
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å®šæœŸæŸ¥çœ‹å¤±è´¥ç»Ÿè®¡

å»ºè®®æ¯å‘¨æŸ¥çœ‹ä¸€æ¬¡å¤±è´¥ç»Ÿè®¡ï¼Œè¯†åˆ«é—®é¢˜è„šæœ¬ï¼š

```bash
# æŸ¥çœ‹æœ€è¿‘7å¤©çš„å¤±è´¥è¶‹åŠ¿
GET /api/v1/failure-analysis/trend?range=week

# æŸ¥çœ‹ç‰¹å®šè„šæœ¬çš„å¤±è´¥ç»Ÿè®¡
GET /api/v1/failure-analysis/scripts/{script_id}/stats
```

### 2. æ ¹æ®å»ºè®®ä¼˜åŒ–è„šæœ¬

æ ¹æ®å¤±è´¥åˆ†ææä¾›çš„å»ºè®®ï¼Œä¼˜åŒ–è„šæœ¬ï¼š

- å¢åŠ ç­‰å¾…æ—¶é—´
- ä¼˜åŒ–å…ƒç´ é€‰æ‹©å™¨
- æ·»åŠ å¼‚å¸¸å¤„ç†
- æ”¹è¿›é”™è¯¯æ¢å¤é€»è¾‘

### 3. å…³æ³¨é«˜é¢‘å¤±è´¥ç±»å‹

é‡ç‚¹å…³æ³¨å‡ºç°é¢‘ç‡æœ€é«˜çš„å¤±è´¥ç±»å‹ï¼š

```bash
# æŸ¥çœ‹å¤±è´¥æ€»è§ˆ
GET /api/v1/failure-analysis/overview?days=30

# æŸ¥çœ‹ most_common_failure å­—æ®µ
```

### 4. åˆ©ç”¨å¤±è´¥æˆªå›¾

å¤±è´¥æˆªå›¾å¯ä»¥å¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜ï¼š

- æˆªå›¾ä¿å­˜åœ¨ `uploads/screenshots/failures/` ç›®å½•
- æ–‡ä»¶åæ ¼å¼: `failure_{task_log_id}_{timestamp}.png`
- å¯ä»¥é€šè¿‡ `screenshot_path` å­—æ®µè·å–è·¯å¾„

### 5. ç›‘æ§å¤±è´¥ç‡

å®šæœŸç›‘æ§è„šæœ¬çš„å¤±è´¥ç‡ï¼š

```bash
# æŸ¥çœ‹è„šæœ¬ç»Ÿè®¡ä¸­çš„ failure_rate å­—æ®µ
GET /api/v1/failure-analysis/scripts/{script_id}/stats
```

å¦‚æœå¤±è´¥ç‡è¶…è¿‡20%ï¼Œå»ºè®®ï¼š
- æ£€æŸ¥è„šæœ¬é€»è¾‘
- ä¼˜åŒ–å…ƒç´ é€‰æ‹©
- å¢åŠ å®¹é”™å¤„ç†
- è€ƒè™‘é‡æ„è„šæœ¬

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: æ–°è„šæœ¬è°ƒè¯•

å¼€å‘æ–°è„šæœ¬æ—¶ï¼Œåˆ©ç”¨å¤±è´¥åˆ†æå¿«é€Ÿå®šä½é—®é¢˜ï¼š

1. æ‰§è¡Œè„šæœ¬
2. æŸ¥çœ‹å¤±è´¥åˆ†æç»“æœ
3. æ ¹æ®å»ºè®®ä¿®æ”¹è„šæœ¬
4. é‡æ–°æ‰§è¡ŒéªŒè¯

### åœºæ™¯2: æ‰¹é‡ä»»åŠ¡ç›‘æ§

æ‰¹é‡æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œç›‘æ§å¤±è´¥æƒ…å†µï¼š

1. æ‰§è¡Œæ‰¹é‡ä»»åŠ¡
2. æŸ¥çœ‹å¤±è´¥æ€»è§ˆ
3. è¯†åˆ«å…±æ€§é—®é¢˜
4. ç»Ÿä¸€ä¼˜åŒ–å¤„ç†

### åœºæ™¯3: å®šæœŸç»´æŠ¤

å®šæœŸç»´æŠ¤è„šæœ¬è´¨é‡ï¼š

1. æŸ¥çœ‹å¤±è´¥è¶‹åŠ¿
2. è¯†åˆ«é—®é¢˜è„šæœ¬
3. ä¼˜åŒ–é«˜é¢‘å¤±è´¥è„šæœ¬
4. é™ä½æ•´ä½“å¤±è´¥ç‡

### åœºæ™¯4: é—®é¢˜æ’æŸ¥

å¿«é€Ÿæ’æŸ¥ä»»åŠ¡å¤±è´¥åŸå› ï¼š

1. æŸ¥çœ‹å¤±è´¥åˆ†æ
2. æŸ¥çœ‹æ­¥éª¤æ—¥å¿—
3. æŸ¥çœ‹å¤±è´¥æˆªå›¾
4. æ ¹æ®å»ºè®®è§£å†³é—®é¢˜

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹ [APIæ¥å£æ–‡æ¡£](./APIæ¥å£æ–‡æ¡£.md)
2. æŸ¥çœ‹ [æµ‹è¯•æŠ¥å‘Š](./è„šæœ¬å¤±è´¥è‡ªåŠ¨åˆ†ææµ‹è¯•æŠ¥å‘Š.md)
3. æŸ¥çœ‹ [å®ç°æ–¹æ¡ˆ](./æ ¸å¿ƒåŠŸèƒ½å®ç°æ–¹æ¡ˆ.md)
4. æäº¤Issueåˆ°é¡¹ç›®ä»“åº“

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æ ¸å¿ƒåŠŸèƒ½å®ç°æ–¹æ¡ˆ](./æ ¸å¿ƒåŠŸèƒ½å®ç°æ–¹æ¡ˆ.md)
- [è„šæœ¬å¤±è´¥è‡ªåŠ¨åˆ†ææµ‹è¯•æŠ¥å‘Š](./è„šæœ¬å¤±è´¥è‡ªåŠ¨åˆ†ææµ‹è¯•æŠ¥å‘Š.md)
- [ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½å®Œæˆæ€»ç»“](./ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½å®Œæˆæ€»ç»“.md)
- [APIæ¥å£æ–‡æ¡£](./APIæ¥å£æ–‡æ¡£.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¶é—´**: 2026-02-22  
**é€‚ç”¨ç‰ˆæœ¬**: ADBweb v1.0+
