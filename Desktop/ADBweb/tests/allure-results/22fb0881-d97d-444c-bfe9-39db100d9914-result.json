{"name": "测试数据完整性约束", "status": "failed", "statusDetails": {"message": "Failed: 脚本名称非空检查失败，发现 10 条违规记录", "trace": "self = <test_comprehensive.TestDataConsistency object at 0x000001C03B849090>\ndb_connection = <sqlite3.Connection object at 0x000001C03BBCB880>\n\n    @allure.story(\"数据完整性\")\n    @allure.title(\"测试数据完整性约束\")\n    @allure.severity(allure.severity_level.NORMAL)\n    def test_data_integrity_constraints(self, db_connection):\n        \"\"\"测试数据完整性约束\"\"\"\n        cursor = db_connection.cursor()\n    \n        checks = [\n            {\n                \"name\": \"设备序列号唯一性\",\n                \"query\": \"\"\"\n                    SELECT serial_number, COUNT(*) as count\n                    FROM device\n                    GROUP BY serial_number\n                    HAVING COUNT(*) > 1\n                \"\"\",\n                \"should_be_empty\": True\n            },\n            {\n                \"name\": \"脚本名称非空\",\n                \"query\": \"SELECT id FROM script WHERE name IS NULL OR name = ''\",\n                \"should_be_empty\": True\n            },\n            {\n                \"name\": \"设备状态有效性\",\n                \"query\": \"SELECT id FROM device WHERE status NOT IN ('online', 'offline', 'busy')\",\n                \"should_be_empty\": True\n            }\n        ]\n    \n        for check in checks:\n            with allure.step(f\"检查{check['name']}\"):\n                cursor.execute(check[\"query\"])\n                results = cursor.fetchall()\n    \n                if check[\"should_be_empty\"] and results:\n                    error_msg = f\"{check['name']}检查失败，发现 {len(results)} 条违规记录\"\n                    allure.attach(str(results), \"违规记录\", allure.attachment_type.TEXT)\n>                   pytest.fail(error_msg)\nE                   Failed: 脚本名称非空检查失败，发现 10 条违规记录\n\ntest_comprehensive.py:862: Failed"}, "description": "测试数据完整性约束", "steps": [{"name": "检查设备序列号唯一性", "status": "passed", "start": 1772039218398, "stop": 1772039218399}, {"name": "检查脚本名称非空", "status": "failed", "statusDetails": {"message": "Failed: 脚本名称非空检查失败，发现 10 条违规记录\n", "trace": "  File \"C:\\Users\\ddd\\Desktop\\ADBweb\\tests\\test_comprehensive.py\", line 862, in test_data_integrity_constraints\n    pytest.fail(error_msg)\n  File \"C:\\Users\\ddd\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\_pytest\\outcomes.py\", line 198, in fail\n    raise Failed(msg=reason, pytrace=pytrace)\n"}, "attachments": [{"name": "违规记录", "source": "f5206b62-627f-4112-b002-01fb9002a552-attachment.txt", "type": "text/plain"}], "start": 1772039218399, "stop": 1772039218402}], "attachments": [{"name": "失败详情", "source": "8a48c8e4-191e-4769-8359-459a6be358a7-attachment.txt", "type": "text/plain"}, {"name": "执行时长", "source": "8fbd3331-60ed-43bb-b719-debce18af714-attachment.txt", "type": "text/plain"}, {"name": "stdout", "source": "f0fbf10f-ed79-457a-9edb-016296079cd3-attachment.txt", "type": "text/plain"}], "start": 1772039218398, "stop": 1772039218403, "uuid": "c23ec209-f600-4ae5-abb3-630f946f794c", "historyId": "6e2f37cea8af4b7b6fa8e89809d59468", "testCaseId": "6e2f37cea8af4b7b6fa8e89809d59468", "fullName": "test_comprehensive.TestDataConsistency#test_data_integrity_constraints", "labels": [{"name": "test_case", "value": "test_data_integrity_constraints"}, {"name": "tag", "value": "data"}, {"name": "story", "value": "数据完整性"}, {"name": "severity", "value": "normal"}, {"name": "feature", "value": "数据一致性"}, {"name": "suite", "value": "test_comprehensive"}, {"name": "subSuite", "value": "TestDataConsistency"}, {"name": "host", "value": "LAPTOP-3V4QFELG"}, {"name": "thread", "value": "12180-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "test_comprehensive"}]}